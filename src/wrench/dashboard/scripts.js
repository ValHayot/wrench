var data=[{"compute":{"end":35.790446376852096,"start":0.0002512268520923695},"execution_host":"Host1","failed":-1,"num_cores_allocated":1,"read":{"end":0.0002512268520923695,"start":0.00019726981948412205},"task_id":"ID00000","terminated":-1,"whole_task":{"end":35.790500336988345,"start":0.00019726981948412205},"write":{"end":35.790500336988345,"start":35.790446376852096}},{"compute":{"end":38.611684255207564,"start":35.79148910520756},"execution_host":"Host1","failed":-1,"num_cores_allocated":1,"read":{"end":35.79148910520756,"start":35.791482446446814},"task_id":"ID00001","terminated":-1,"whole_task":{"end":38.61169091441169,"start":35.791482446446814},"write":{"end":38.61169091441169,"start":38.611684255207564}},{"compute":{"end":38.47207886985551,"start":35.791883719855505},"execution_host":"Host1","failed":-1,"num_cores_allocated":1,"read":{"end":35.791883719855505,"start":35.79187698608579},"task_id":"ID00002","terminated":-1,"whole_task":{"end":38.4720856040686,"start":35.79187698608579},"write":{"end":38.4720856040686,"start":38.47207886985551}},{"compute":{"end":38.54247328432496,"start":35.79227813432496},"execution_host":"Host1","failed":-1,"num_cores_allocated":1,"read":{"end":35.79227813432496,"start":35.792271525724765},"task_id":"ID00003","terminated":-1,"whole_task":{"end":38.54247989336853,"start":35.792271525724765},"write":{"end":38.54247989336853,"start":38.54247328432496}},{"compute":{"end":40.35286789674193,"start":35.79267274674192},"execution_host":"Host1","failed":-1,"num_cores_allocated":1,"read":{"end":35.79267274674192,"start":35.79266606536374},"task_id":"ID00004","terminated":-1,"whole_task":{"end":40.35287457856349,"start":35.79266606536374},"write":{"end":40.35287457856349,"start":40.35286789674193}},{"compute":{"end":39.913262764860086,"start":35.793067614860085},"execution_host":"Host1","failed":-1,"num_cores_allocated":1,"read":{"end":35.793067614860085,"start":35.793060605002715},"task_id":"ID00005","terminated":-1,"whole_task":{"end":39.913269775160835,"start":35.793060605002715},"write":{"end":39.913269775160835,"start":39.913262764860086}},{"compute":{"end":41.30365714285166,"start":35.79346199285167},"execution_host":"Host1","failed":-1,"num_cores_allocated":1,"read":{"end":35.79346199285167,"start":35.79345514464169},"task_id":"ID00006","terminated":-1,"whole_task":{"end":41.30366399150502,"start":35.79345514464169},"write":{"end":41.30366399150502,"start":41.30365714285166}},{"compute":{"end":38.34405181944918,"start":35.79385666944918},"execution_host":"Host1","failed":-1,"num_cores_allocated":1,"read":{"end":35.79385666944918,"start":35.793849684280666},"task_id":"ID00007","terminated":-1,"whole_task":{"end":38.34405880506107,"start":35.793849684280666},"write":{"end":38.34405880506107,"start":38.34405181944918}},{"compute":{"end":39.444445808311194,"start":35.79425065831119},"execution_host":"Host1","failed":-1,"num_cores_allocated":1,"read":{"end":35.79425065831119,"start":35.79424422391964},"task_id":"ID00008","terminated":-1,"whole_task":{"end":39.444452243146124,"start":35.79424422391964},"write":{"end":39.444452243146124,"start":39.444445808311194}},{"compute":{"end":39.70287154109849,"start":38.61267639109848},"execution_host":"Host1","failed":-1,"num_cores_allocated":1,"read":{"end":38.61267639109848,"start":38.61267302387016},"task_id":"ID00009","terminated":-1,"whole_task":{"end":39.70287384586667,"start":38.61267302387016},"write":{"end":39.70287384586667,"start":39.70287154109849}},{"compute":{"end":39.753266219899054,"start":38.47307106989905},"execution_host":"Host1","failed":-1,"num_cores_allocated":1,"read":{"end":38.47307106989905,"start":38.47306771352707},"task_id":"ID00010","terminated":-1,"whole_task":{"end":39.753268512400425,"start":38.47306771352707},"write":{"end":39.753268512400425,"start":39.753266219899054}},{"compute":{"end":39.36366044908269,"start":38.54346529908268},"execution_host":"Host1","failed":-1,"num_cores_allocated":1,"read":{"end":38.54346529908268,"start":38.543462002827},"task_id":"ID00011","terminated":-1,"whole_task":{"end":39.36366287836506,"start":38.543462002827},"write":{"end":39.36366287836506,"start":39.36366044908269}},{"compute":{"end":41.474055038652956,"start":40.353859888652956},"execution_host":"Host1","failed":-1,"num_cores_allocated":1,"read":{"end":40.353859888652956,"start":40.353856688021956},"task_id":"ID00012","terminated":-1,"whole_task":{"end":41.474057418085664,"start":40.353856688021956},"write":{"end":41.474057418085664,"start":41.474055038652956}},{"compute":{"end":40.824450383622015,"start":39.914255233622015},"execution_host":"Host1","failed":-1,"num_cores_allocated":1,"read":{"end":39.914255233622015,"start":39.914251884619304},"task_id":"ID00013","terminated":-1,"whole_task":{"end":40.82445239285676,"start":39.914251884619304},"write":{"end":40.82445239285676,"start":40.824450383622015}},{"compute":{"end":42.704844622438365,"start":41.30464947243836},"execution_host":"Host1","failed":-1,"num_cores_allocated":1,"read":{"end":41.30464947243836,"start":41.30464610096349},"task_id":"ID00014","terminated":-1,"whole_task":{"end":42.70484655256308,"start":41.30464610096349},"write":{"end":42.70484655256308,"start":42.704844622438365}},{"compute":{"end":39.54523938705446,"start":38.34504423705445},"execution_host":"Host1","failed":-1,"num_cores_allocated":1,"read":{"end":38.34504423705445,"start":38.34504091451954},"task_id":"ID00015","terminated":-1,"whole_task":{"end":39.54524258501867,"start":38.34504091451954},"write":{"end":39.54524258501867,"start":39.54523938705446}},{"compute":{"end":40.34563282132768,"start":39.44543767132768},"execution_host":"Host1","failed":-1,"num_cores_allocated":1,"read":{"end":39.44543767132768,"start":39.44543435260459},"task_id":"ID00016","terminated":-1,"whole_task":{"end":40.34563717978004,"start":39.44543435260459},"write":{"end":40.34563717978004,"start":40.34563282132768}},{"compute":{"end":41.18405341009332,"start":39.70385826009332},"execution_host":"Host1","failed":-1,"num_cores_allocated":1,"read":{"end":39.70385826009332,"start":39.70385595532514},"task_id":"ID00017","terminated":-1,"whole_task":{"end":41.18405399244908,"start":39.70385595532514},"write":{"end":41.18405399244908,"start":41.18405341009332}},{"compute":{"end":41.78444806436027,"start":39.754252914360265},"execution_host":"Host1","failed":-1,"num_cores_allocated":1,"read":{"end":39.754252914360265,"start":39.754250621858894},"task_id":"ID00018","terminated":-1,"whole_task":{"end":41.784448644007895,"start":39.754250621858894},"write":{"end":41.784448644007895,"start":41.78444806436027}},{"compute":{"end":40.884842567105906,"start":39.36464741710591},"execution_host":"Host1","failed":-1,"num_cores_allocated":1,"read":{"end":39.36464741710591,"start":39.36464498782353},"task_id":"ID00019","terminated":-1,"whole_task":{"end":40.8848431624598,"start":39.36464498782353},"write":{"end":40.8848431624598,"start":40.884842567105906}},{"compute":{"end":42.865237056976845,"start":41.47504190697684},"execution_host":"Host1","failed":-1,"num_cores_allocated":1,"read":{"end":41.47504190697684,"start":41.47503952754413},"task_id":"ID00020","terminated":-1,"whole_task":{"end":42.86523761934147,"start":41.47503952754413},"write":{"end":42.86523761934147,"start":42.865237056976845}},{"compute":{"end":42.315631661549986,"start":40.82543651154998},"execution_host":"Host1","failed":-1,"num_cores_allocated":1,"read":{"end":40.82543651154998,"start":40.82543450231523},"task_id":"ID00021","terminated":-1,"whole_task":{"end":42.31563225161859,"start":40.82543450231523},"write":{"end":42.31563225161859,"start":42.315631661549986}},{"compute":{"end":44.40602574214628,"start":42.70583059214627},"execution_host":"Host1","failed":-1,"num_cores_allocated":1,"read":{"end":42.70583059214627,"start":42.70582866202155},"task_id":"ID00022","terminated":-1,"whole_task":{"end":44.40602620726575,"start":42.70582866202155},"write":{"end":44.40602620726575,"start":44.40602574214628}},{"compute":{"end":41.85642304244136,"start":39.54622789244135},"execution_host":"Host1","failed":-1,"num_cores_allocated":1,"read":{"end":39.54622789244135,"start":39.54622469447714},"task_id":"ID00023","terminated":-1,"whole_task":{"end":41.85642368280886,"start":39.54622469447714},"write":{"end":41.85642368280886,"start":41.85642304244136}},{"compute":{"end":43.566818797690864,"start":40.34662364769087},"execution_host":"Host1","failed":-1,"num_cores_allocated":1,"read":{"end":40.34662364769087,"start":40.34661928923851},"task_id":"ID00024","terminated":-1,"whole_task":{"end":43.56681977948589,"start":40.34661928923851},"write":{"end":43.56681977948589,"start":43.566818797690864}},{"compute":{"end":12556.4463316142,"start":41.18613646423874},"execution_host":"Host1","failed":-1,"num_cores_allocated":1,"read":{"end":41.18613646423874,"start":41.18503610190755},"task_id":"ID00025","terminated":-1,"whole_task":{"end":12556.446332247157,"start":41.18503610190755},"write":{"end":12556.446332247157,"start":12556.4463316142}},{"compute":{"end":11348.516726263062,"start":41.786531113089424},"execution_host":"Host1","failed":-1,"num_cores_allocated":1,"read":{"end":41.786531113089424,"start":41.785430753466365},"task_id":"ID00026","terminated":-1,"whole_task":{"end":11348.516726893076,"start":41.785430753466365},"write":{"end":11348.516726893076,"start":11348.516726263062}},{"compute":{"end":11119.287120797206,"start":40.8869256472476},"execution_host":"Host1","failed":-1,"num_cores_allocated":1,"read":{"end":40.8869256472476,"start":40.88582527191827},"task_id":"ID00027","terminated":-1,"whole_task":{"end":11119.287121444291,"start":40.88582527191827},"write":{"end":11119.287121444291,"start":11119.287120797206}},{"compute":{"end":17545.277515221132,"start":42.86732007114},"execution_host":"Host1","failed":-1,"num_cores_allocated":1,"read":{"end":42.86732007114,"start":42.86621972879994},"task_id":"ID00028","terminated":-1,"whole_task":{"end":17545.27751583236,"start":42.86621972879994},"write":{"end":17545.27751583236,"start":17545.277515221132}},{"compute":{"end":11752.597909881104,"start":42.31771473112109},"execution_host":"Host1","failed":-1,"num_cores_allocated":1,"read":{"end":42.31771473112109,"start":42.31661436107706},"task_id":"ID00029","terminated":-1,"whole_task":{"end":11752.597910522445,"start":42.31661436107706},"write":{"end":11752.597910522445,"start":11752.597909881104}},{"compute":{"end":9781.87830371182,"start":44.40810856181912},"execution_host":"Host1","failed":-1,"num_cores_allocated":1,"read":{"end":44.40810856181912,"start":44.407008316724216},"task_id":"ID00030","terminated":-1,"whole_task":{"end":9781.878304217345,"start":44.407008316724216},"write":{"end":9781.878304217345,"start":9781.87830371182}},{"compute":{"end":15312.168701362587,"start":41.858506212610266},"execution_host":"Host1","failed":-1,"num_cores_allocated":1,"read":{"end":41.858506212610266,"start":41.85740579226733},"task_id":"ID00031","terminated":-1,"whole_task":{"end":15312.1687020586,"start":41.85740579226733},"write":{"end":15312.1687020586,"start":15312.168701362587}},{"compute":{"end":18962.25909780072,"start":43.56890265071482},"execution_host":"Host1","failed":-1,"num_cores_allocated":1,"read":{"end":43.56890265071482,"start":43.56780188894436},"task_id":"ID00032","terminated":-1,"whole_task":{"end":18962.259098867853,"start":43.56780188894436},"write":{"end":18962.259098867853,"start":18962.25909780072}},{"compute":{"end":18974.300281558626,"start":18962.260086408623},"execution_host":"Host1","failed":-1,"num_cores_allocated":1,"read":{"end":18962.260086408623,"start":18962.260080977325},"task_id":"ID00033","terminated":-1,"whole_task":{"end":18974.300286859925,"start":18962.260080977325},"write":{"end":18974.300286859925,"start":18974.300281558626}},{"compute":{"end":18974.321469240356,"start":18974.301274090354},"execution_host":"Host1","failed":-1,"num_cores_allocated":1,"read":{"end":18974.301274090354,"start":18974.301268969397},"task_id":"ID00034","terminated":-1,"whole_task":{"end":18974.321469317118,"start":18974.301268969397},"write":{"end":18974.321469317118,"start":18974.321469240356}},{"compute":{"end":24633.783746433328,"start":18974.323551283327},"execution_host":"Host1","failed":-1,"num_cores_allocated":1,"read":{"end":18974.323551283327,"start":18974.32245142659},"task_id":"ID00035","terminated":-1,"whole_task":{"end":24633.783746756326,"start":18974.32245142659},"write":{"end":24633.783746756326,"start":24633.783746433328}}]

function generateGraph() {
    var keys = ['read', 'compute', 'write', 'whole_task'];
    data.forEach(function(task, i) {
        task.start = task['whole_task'].start;
        keys.forEach(function(k) {
            task[k] = task[k].end - task[k].start;
        });
    });
    var read_color    = '#cbb5dd';
    var compute_color = '#f7daad';
    var write_color   = '#abdcf4';
    var colors        = [read_color, compute_color, write_color];
    var container = d3.select("#container");
    const CONTAINER_WIDTH = container.style("width").slice(0, -2); // returns "XXXXpx" so need to remove "px"
    const CONTAINER_HEIGHT = container.style("height").slice(0, -2);
    const PADDING = 60;
    var svg = container
        .append("svg")
        .attr('width', CONTAINER_WIDTH)
        .attr('height', CONTAINER_HEIGHT);

    //axes
    var xscale = d3.scaleLinear()
        .domain([0, d3.max(data, function (d) {
            return d['read'] + d['compute'] + d['write'] + d['start'];
        })])
        .range([PADDING, CONTAINER_WIDTH - PADDING]);

    var task_ids = [];
    data.forEach(function(task) {
        task_ids.push(task['task_id']);
    });

    task_ids.sort(function(lhs, rhs) {
       return parseInt(lhs.slice(4)) - parseInt(rhs.slice(4));
    });

    var yscale = d3.scaleBand()
        .domain(task_ids)
        .range([CONTAINER_HEIGHT - PADDING, 30])
        .padding(0.1);

    var x_axis = d3.axisBottom()
        .scale(xscale);

    var y_axis = d3.axisLeft()
        .scale(yscale);

    svg.append('g')
        .attr('class', 'y-axis')
        .attr('transform',
            'translate(' + PADDING + ',0)')
        .call(y_axis);

    svg.append('g')
        .attr('class', 'x-axis')
        .attr('transform',
            'translate(0,' + (CONTAINER_HEIGHT - PADDING) + ')')
        .call(x_axis);
        
    // svg.append('g')
    //     .attr("fill", "steelblue")
    //     .selectAll("rect").data(data).enter().append("rect")


    // Stack layout
    var stack = d3.stack().keys([
        'read', 'compute', 'write'
    ]);

    var stack_data = stack(data);
    console.log(stack_data)

    // Groups
    var groups = svg.selectAll('g')
        .data(stack_data[0])
        .enter()
        .append('g')
        // .attr('class', function(d) {
        //     return d.key;
        // })
        // .style('fill', function(d, i) {
        //     return colors[i];
        // });
    console.log(groups);

    // Add the data
    groups.selectAll('rect')
        .data(function(d) {
            return d;
        })
        .enter()
        .append('rect')
        .attr('x', function(d) {
            return xscale(d[0] + d['data'].start);
        })
        .attr('y', function(d) {
            return yscale(d['data'].task_id);
        })
        .attr('height', function(d) {
            return yscale.bandwidth();
        })
        .attr('width', function(d) {
            return xscale(d[1]) - xscale(d[0]);
        })
        // .on('mouseover', function() {
        //     tooltip.style('display', 'inline');

        //     d3.select(this)
        //         .attr('stroke', 'gray')
        //         .style('stroke-width', '1');
        // })
        // .on('mousemove', function(d) {
        //     var offset = getOffset(chart);
        //     var x = d3.event.pageX - offset.left + 20;
        //     var y = d3.event.pageY - offset.top - 30; // 20 seems to account for the padding of the chart-block

        //     tooltip.style('left', x + 'px')
        //         .style('top', y + 'px');

        //     tooltip_task_id.text('TaskID: ' + d.data.task_id);

        //     var parent_group = d3.select(this.parentNode).attr('class');

        //     if (parent_group == 'read') {
        //         tooltip_task_operation.text('Read Input');
        //     } else if (parent_group == 'compute') {
        //         tooltip_task_operation.text('Computation');
        //     } else if (parent_group == 'write') {
        //         tooltip_task_operation.text('Write Output');
        //     }

        //     var duration = toFiveDecimalPlaces(d[1] - d[0]);
        //     tooltip_task_operation_duration.text('Duration: ' + duration + 's');

        // })
        // .on('mouseout', function(d) {
        //     tooltip.style('display', 'none');

        //     d3.select(this)
        //         .attr('stroke', 'none')
        // });

        // svg.append("groups");
}